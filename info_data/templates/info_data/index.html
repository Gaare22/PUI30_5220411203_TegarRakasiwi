{% load static %}
<!DOCTYPE html>
<html lang="id">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>TRLearn</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
      <!-- style css -->
      <link rel="stylesheet" href="{% static 'css/style.css' %}">
      <!-- Responsive-->
      <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
      <!-- fevicon -->
      <link rel="icon" href="{% static 'img/gabel_logo1.png' %}" type="image/gif" />
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->

      <style>
        .box {
        background-color: #d9d9d9;
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        }

        .large-box {
        height: 500px;
        }

        .data-table {
        background-color: white;
        border-radius: 10px;
        overflow: auto;
        max-height: 450px;
        }

        .btn-rounded {
        border-radius: 25px;
        padding: 10px 30px;
        }

        .dropdown-box {
        border: 1px solid #000;
        border-radius: 10px;
        padding: 10px 20px;
        background-color: #d9d9d9;
        }

        .select-style {
        border: none;
        background: transparent;
        outline: none;
        font-weight: bold;
        }

        table {
        width: 100%;
        }

        th, td {
        padding: 6px 10px;
        font-size: 14px;
        }

        .ak-box {
        height: 200px;
        }

      .submit:hover {
         background-color: #f0390f;
      }

      input[type="file"] {
         display: none;
      }

      .pagination {
        margin-top: 15px; /* jarak atas tabel */
        margin-bottom: 10px;
        }

        .pagination .page-link {
        border-radius: 8px;
        margin: 0 6px;        /* jarak antar tombol diperbesar */
        padding: 8px 16px;    /* tombol lebih lebar */
        color: black;
        }

        .pagination .page-item.active .page-link {
        background-color: #f0390f;
        border-color: #f0390f;
        color: white;
        }

        .pagination .page-link:hover {
        background-color: #f0390f;   /* merah saat hover */
        color: white;
        border-color: #f0390f;
        }
        /* Pastikan navbar tidak wrap ke 2 baris */
         .navbar-nav {
            flex-wrap: nowrap;
         }

         .navbar-nav .nav-item .nav-link {
            white-space: nowrap; /* cegah teks jadi 2 baris */
         }


      </style>
   </head>
   <!-- body -->
   <body class="main-layout">
      <!-- header -->
      <div class="header">
         <div class="container-fluid">
            <div class="row d_flex">
               <div class=" col-md-2 col-sm-3 col logo_section">
                  <div class="full">
                     <div class="center-desk">
                        <div class="logo">
                           <a href="/"><img src="{% static 'img/gabel_logo1.png' %}" alt="#" /></a>
                        </div>
                     </div>
                  </div>
               </div>
               
               <div class="col-md-10 col-sm-12">
                  <nav class="navigation navbar navbar-expand-md navbar-dark ">
                     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04"
                        aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                     </button>
                     <div class="collapse navbar-collapse" id="navbarsExample04">
                        <!-- Menu kiri -->
                        <ul class="navbar-nav mr-auto">
                           <li class="nav-item">
                              <a class="nav-link" href="/homeadmin/">Dashboard</a>
                           </li>
                           <li class="nav-item active">
                              <a class="nav-link" href="/info_data/">Data</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/input_data/">Input Data</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/pelatihan/">Pelatihan</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/pengujian/">Pengujian</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/prediksi_admin/">Prediksi</a>
                           </li>
                        </ul>
                        <!-- Logout di kanan -->
                        <ul class="navbar-nav ml-auto">
                           <li class="nav-item">
                              <a class="nav-link" href="/">Logout</a>
                           </li>
                        </ul>
                     </div>
                  </nav>
               </div>


            </div>
         </div>
      </div>

      <br>
      <br>
      <br>
      <hr style="border-top: 2px solid #f0390f; border-bottom: 0;">
      <br>
      <!-- end header inner -->
      <!-- end header -->
      <div class="container-fluid py-4">
        <div class="row">
          <!-- Kolom Kiri -->
          <div class="col-md-8" style="padding-left: 45px;">
            <div id="data-box" class="box large-box data-tampilan" style="margin-top: 30px; width: 1150px;">
              <h5 class="mb-4">INFORMASI DATA</h5>
              <div class="data-table mx-auto w-100" style="max-height: 400px; overflow: auto;">
               <div id="data-content">
                  {% if data_preview %}
                     {{ data_preview|safe }}
                  {% else %}
                     Silakan pilih sumber data.
                  {% endif %}
               </div>
              </div>
            </div>
          </div>
    
          <!-- Kolom Kanan -->
          <!-- <div class="col-md-4 d-flex flex-column justify-content-between"> -->
            <form action="" method="post"> {% csrf_token %}
               <div class="mb-3" style=" padding-left: 48px; margin-top: -570px;">
               <div class="dropdown-box d-flex justify-content-between align-items-center mb-3">
                  <span>PILIH DATA YANG DIGUNAKAN :</span>
                  <select name="source" id="dataSource" onchange="handleDataSourceChange()" class="select-style" required>
                     <option selected>-- PILIH DATA --</option>
                     <option value="pelatihan" {% if selected_source == "pelatihan" %}selected{% endif %}>Data Pelatihan</option>
                     <option value="prediksi" {% if selected_source == "prediksi" %}selected{% endif %}>Data prediksi</option>
                     <!-- <option value="csv" {% if selected_source == "csv" %}selected{% endif %}>Import CSV</option> -->
                  </select>
               </div>

               <input type="file" id="csv-upload" accept=".csv" style="display: none;">
               </div>
            </form>

            
          <!-- </div> -->
        </div>
      </div>

      

        <!--  footer -->
        <!-- end footer -->
        <!-- Javascript files-->
        <script src="{% static 'js/jquery.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'js/jquery-3.0.0.min.js' %}"></script>
        <!-- sidebar -->
        <script src="{% static 'js/custom.js' %}"></script>
        <script>
            function handleDataSourceChange() {
               const selected = document.getElementById("dataSource").value;
               const dataContent = document.getElementById("data-content");

               if (selected === "pelatihan") {
                  loadPage(1);
               } else if (selected === "prediksi") {
                  loadPagePred(1);
               } else {
                  dataContent.innerHTML = "Silakan pilih data yang digunakan";
               }
            }

            function displayTable(columns, rows, num_pages = 1, current_page = 1) {
               let html = "<table border='1'><tr>";
               columns.forEach(col => {
                  html += `<th>${col}</th>`;
               });
               html += "</tr>";

               rows.forEach(row => {
                  html += "<tr>";
                  row.forEach(cell => {
                     html += `<td>${cell}</td>`;
                  });
                  html += "</tr>";
               });
               html += "</table>";

               if (num_pages > 1) {
                  html += `<nav aria-label="Page navigation">
                              <ul class="pagination justify-content-center">`;

                  // Tombol First
                  if (current_page > 1) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPage(1)">First</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">First</span></li>`;
                  }

                  // Tombol Previous
                  if (current_page > 1) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPage(${current_page - 1})">Previous</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">Previous</span></li>`;
                  }

                  // Nomor halaman (maks. 3 tampilan terdekat)
                  let start = Math.max(1, current_page - 1);
                  let end = Math.min(num_pages, current_page + 1);

                  if (start > 1) html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                  for (let i = start; i <= end; i++) {
                     if (i === current_page) {
                           html += `<li class="page-item active"><span class="page-link" style="background-color:#f0390f;border-color:#f0390f;">${i}</span></li>`;
                     } else {
                           html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPage(${i})">${i}</a></li>`;
                     }
                  }
                  if (end < num_pages) html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;

                  // Tombol Next
                  if (current_page < num_pages) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPage(${current_page + 1})">Next</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">Next</span></li>`;
                  }

                  // Tombol Last
                  if (current_page < num_pages) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPage(${num_pages})">Last</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">Last</span></li>`;
                  }

                  html += `</ul></nav>`;
               }

               document.getElementById("data-content").innerHTML = html;
            }

            function displayTablePred(columns, rows, num_pages = 1, current_page = 1) {
               let html = "<table border='1'><tr>";
               columns.forEach(col => {
                  html += `<th>${col}</th>`;
               });
               html += "</tr>";

               rows.forEach(row => {
                  html += "<tr>";
                  row.forEach(cell => {
                     html += `<td>${cell}</td>`;
                  });
                  html += "</tr>";
               });
               html += "</table>";

               if (num_pages > 1) {
                  html += `<nav aria-label="Page navigation">
                              <ul class="pagination justify-content-center">`;

                  // Tombol First
                  if (current_page > 1) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPagePred(1)">First</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">First</span></li>`;
                  }

                  // Tombol Previous
                  if (current_page > 1) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPagePred(${current_page - 1})">Previous</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">Previous</span></li>`;
                  }

                  // Nomor halaman (maks. 3 tampilan terdekat)
                  let start = Math.max(1, current_page - 1);
                  let end = Math.min(num_pages, current_page + 1);

                  if (start > 1) html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                  for (let i = start; i <= end; i++) {
                     if (i === current_page) {
                           html += `<li class="page-item active"><span class="page-link" style="background-color:#f0390f;border-color:#f0390f;">${i}</span></li>`;
                     } else {
                           html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPagePred(${i})">${i}</a></li>`;
                     }
                  }
                  if (end < num_pages) html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;

                  // Tombol Next
                  if (current_page < num_pages) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPagePred(${current_page + 1})">Next</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">Next</span></li>`;
                  }

                  // Tombol Last
                  if (current_page < num_pages) {
                     html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="loadPagePred(${num_pages})">Last</a></li>`;
                  } else {
                     html += `<li class="page-item disabled"><span class="page-link">Last</span></li>`;
                  }

                  html += `</ul></nav>`;
               }


               document.getElementById("data-content").innerHTML = html;
            }

            function loadPage(page) {
               fetch(`/info_data/get_data_pelatihan/?page=${page}`)
               .then(response => response.json())
               .then(data => {
                  if (data.success) {
                     displayTable(data.columns, data.rows, data.num_pages, data.current_page);
                  } else {
                     document.getElementById("data-content").innerHTML = "Gagal memuat data.";
                  }
               });
            }

            function loadPagePred(page) {
               fetch(`/info_data/get_data_prediksi/?page=${page}`)
               .then(response => response.json())
               .then(data => {
                  if (data.success) {
                     displayTablePred(data.columns, data.rows, data.num_pages, data.current_page);
                  } else {
                     document.getElementById("data-content").innerHTML = "Gagal memuat data.";
                  }
               });
            }

            document.getElementById("dataSource").addEventListener("change", function () {
               document.getElementById("selectedSource").value = this.value;
            });

            document.getElementById("form-pelatihan").addEventListener("submit", function(e) {
               const sourceSelected = document.querySelector('input[name="source"]:checked');
               if (!sourceSelected) {
                  alert("Silakan pilih sumber data terlebih dahulu (CSV atau Database).");
                  e.preventDefault();
               }
            });
        </script>
    </body>
</html>